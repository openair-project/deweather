<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function to run random meteorological simulations on a deweather model ‚Äî simulate_dw_met ‚Ä¢ deweather</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to run random meteorological simulations on a deweather model ‚Äî simulate_dw_met"><meta name="description" content="This function performs random simulations to help isolate the effect of
emissions changes from meteorological variability in air quality data. It
works by repeatedly shuffling meteorological variables (like wind and air
temperature) while keeping temporal patterns intact, then predicting
pollutant concentrations using a trained deweather model."><meta property="og:description" content="This function performs random simulations to help isolate the effect of
emissions changes from meteorological variability in air quality data. It
works by repeatedly shuffling meteorological variables (like wind and air
temperature) while keeping temporal patterns intact, then predicting
pollutant concentrations using a trained deweather model."><meta property="og:image" content="https://openair-project.github.io/deweather/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">deweather</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/deweather.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies-external-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies (External)</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies-external-"><li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/pii/S004896971834244X">(2019) Using meteorological normalisation to detect interventions in air quality time series</a></li>
    <li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/abs/pii/S1352231012001355">(2012) A short-term intervention study ‚Äî Impact of airport closure due to the eruption of Eyjafjallaj√∂kull on near-field air quality</a></li>
    <li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/abs/pii/S1352231009003069">(2009) Analysis of air pollution data at a mixed source location using boosted regression trees</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openair-project" aria-label="Website"><span class="fa fa-globe"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://openair-project.github.io/book/" aria-label="Book"><span class="fa fa-book"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openair-project/deweather/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages"><li><h6 class="dropdown-header" data-toc-skip>Data Analysis</h6></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/openair/">üß≠ openair</a></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/openairmaps/">üó∫Ô∏è openairmaps</a></li>
    <li><a class="dropdown-item" href="https://openair-project.github.io/deweather/">üìâ deweather</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data Access</h6></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/worldmet/">üçÉ worldmet</a></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/euroaq/">üåç euroaq</a></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/ukaq/">üëë ukaq</a></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Function to run random meteorological simulations on a deweather model</h1>
      <small class="dont-index">Source: <a href="https://github.com/openair-project/deweather/blob/main/R/simulate_dw_met.R" class="external-link"><code>R/simulate_dw_met.R</code></a></small>
      <div class="d-none name"><code>simulate_dw_met.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs random simulations to help isolate the effect of
emissions changes from meteorological variability in air quality data. It
works by repeatedly shuffling meteorological variables (like wind and air
temperature) while keeping temporal patterns intact, then predicting
pollutant concentrations using a trained deweather model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulate_dw_met</span><span class="op">(</span></span>
<span>  <span class="va">dw</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu">deweather</span><span class="fu">::</span><span class="fu"><a href="getters-dw.html">get_dw_input_data</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ws"</span>, <span class="st">"wd"</span>, <span class="st">"air_temp"</span><span class="op">)</span>,</span>
<span>  resampling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"constrained"</span>, <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  window_day <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  window_hour <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  aggregate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_interactive.html" class="external-link">is_interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dw">dw<a class="anchor" aria-label="anchor" href="#arg-dw"></a></dt>
<dd><p>A deweather model created with <code><a href="build_dw_model.html">build_dw_model()</a></code>.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>Data set to which to apply the model. If missing the data used
to build the model in the first place will be used.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>The variables that should be randomly varied. Note that these
should typically be meteorological variables (e.g., <code>"ws"</code>, <code>"wd"</code>,
<code>"air_temp"</code>) and not temporal emission proxies (e.g., <code>"hour"</code>,
<code>"weekday"</code>, <code>"week"</code>).</p></dd>


<dt id="arg-resampling">resampling<a class="anchor" aria-label="anchor" href="#arg-resampling"></a></dt>
<dd><p>The resampling strategy. One of:</p><ul><li><p><code>"constrained"</code> (default), meaning that only days of the year close to
the target date are sampled. This option is used in conjunction with
<code>window_day</code> and <code>window_hour</code>. For example, a <code>window_day</code> of <code>30</code> will
sample +/-30 days of the date.</p></li>
<li><p><code>"all"</code>, meaning all dates are shuffled.</p></li>
</ul><p>The argument for using constrained resampling is that it resamples
conditions for a similar time of year and / or hour of the day to minimise
the resampling of implausible conditions e.g. very warm temperatures during
winter.</p></dd>


<dt id="arg-window-day-window-hour">window_day, window_hour<a class="anchor" aria-label="anchor" href="#arg-window-day-window-hour"></a></dt>
<dd><p>The day of year (<code>window_day</code>) and hour of day
(<code>window_hour</code>) windows to sample within when <code>resampling = "constrained"</code>.
For example, <code>window_day = 30</code> samples within +/-30 days of any given date.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>The number of simulations to use.</p></dd>


<dt id="arg-aggregate">aggregate<a class="anchor" aria-label="anchor" href="#arg-aggregate"></a></dt>
<dd><p>By default, all of the simulations will be aggregated into a
single time series. When <code>aggregate = FALSE</code>, all simulations will be
returned in a single data frame with an <code>.id</code> column distinguishing between
them.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Show a progress bar? Defaults to <code>TRUE</code> in interactive
sessions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

